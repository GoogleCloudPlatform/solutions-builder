name: Auth and setup Cloud SDK with Service Account

inputs:
  credentials_json:
    description: |-
      Google Cloud credential JSON of a Service Account with
      necessary permissions to access gcloud and set up the
      project.
    required: true

jobs:
  gcloud_setup:
    using: composite
    steps:
    # https://github.com/google-github-actions/auth
    - id: 'auth'
      name: Auth with Service Account
      uses: 'google-github-actions/auth@v1'
      with:
        # FIXME: Use workload identity instead of service account key.
        # workload_identity_provider: ''
        # service_account: 'deployment-dev@${{ env.PROJECT_ID }}.iam.gserviceaccount.com'
        credentials_json: ${{ inputs.credentials_json }}

    - name: Set up Cloud SDK
      uses: 'google-github-actions/setup-gcloud@v1'
